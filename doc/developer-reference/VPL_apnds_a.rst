===================================
Configuration Parameter Constraints
===================================

The mfxFrameInfo structure is used by both the :cpp:struct:`mfxVideoParam`
structure during SDK class initialization and the :cpp:struct:`mfxFrameSurface1`
structure during the actual SDK class function. The parameter constraints
described in the following tables apply.

------------------------------------------
DECODE, ENCODE, and VPP Common Constraints
------------------------------------------

+--------------+---------------------------+-----------------------------------------------------------+
| Parameters   | During SDK Initialization | During SDK Operation                                      |
+==============+===========================+===========================================================+
| FourCC       | Any valid value           | The value must be the same as the initialization value.   |
|              |                           | The only exception is **VPP** in composition mode, where  |
|              |                           | in some cases it is allowed to mix RGB and NV12 surfaces. |
|              |                           | See :cpp:struct:`mfxExtVPPComposite` for more details.    |
+--------------+---------------------------+-----------------------------------------------------------+
| ChromaFormat | Any valid value           | The value must be the same as the initialization value.   |
+--------------+---------------------------+-----------------------------------------------------------+

------------------
DECODE Constraints
------------------

+---------------+-----------------------------------------+----------------------------------------+
| Parameters    | During SDK initialization               | During SDK operation                   |
+===============+=========================================+========================================+
| Width         | Aligned frame size                      | The values must be the equal to or     |
|               |                                         | larger than the initialization values. |
| Height        |                                         |                                        |
+---------------+-----------------------------------------+----------------------------------------+
| CropX, CropY  | Ignored                                 | **DECODE** output. The cropping values |
|               |                                         | are per-frame based.                   |
| CropW, CropH  |                                         |                                        |
+---------------+-----------------------------------------+----------------------------------------+
| AspectRatioW  | Any valid values or unspecified (zero); | **DECODE** output.                     |
|               | if unspecified, values from the input   |                                        |
| AspectRatioH  | bitstream will be used.                 |                                        |
|               | See note below the table.               |                                        |
+---------------+-----------------------------------------+----------------------------------------+
| FrameRateExtN | If unspecified, values from the input   | **DECODE** output.                     |
|               | bitstream will be used.                 |                                        |
| FrameRateExtD | See note below the table.               |                                        |
+---------------+-----------------------------------------+----------------------------------------+
| PicStruct     | Ignored                                 | **DECODE** output.                     |
+---------------+-----------------------------------------+----------------------------------------+

.. note:: Note about priority of initialization parameters.

.. note:: If the application explicitly sets FrameRateExtN/FrameRateExtD or
          AspectRatioW/AspectRatioH during initialization, then the decoder will
          use these values during decoding regardless of the values from bitstream
          and does not update them on new SPS. If the application sets them to 0,
          then the decoder uses values from the stream and updates them on each SPS.

------------------
ENCODE Constraints
------------------

.. note:: TODO This table differs from the equivalent table in the spec. Which should be considered the correct version?

+-------------------+----------------------------------------------+---------------------------------------------------------------------------+
| Parameters        | During SDK initialization                    | During SDK operation                                                      |
+===================+==============================================+===========================================================================+
| Width, Height     | Encoded frame aligned size                   | Must be the <=  the initialization values                                 |
+-------------------+----------------------------------------------+---------------------------------------------------------------------------+
| CropX, CropY      | must be zero                                 | Ignored                                                                   |
+-------------------+----------------------------------------------+---------------------------------------------------------------------------+
|                   |                                              |                                                                           |
| CropW, CropH      | specify the real width and height            |                                                                           |
|                   | (maybe unaligned) of the coded frames        |                                                                           |
|                   |                                              |                                                                           |
+-------------------+----------------------------------------------+---------------------------------------------------------------------------+
| AspectRatioW      | Any valid values                             | Ignored                                                                   |
|                   |                                              |                                                                           |
| AspectRatioH      |                                              |                                                                           |
+-------------------+----------------------------------------------+---------------------------------------------------------------------------+
| FrameRateExtN     | Any valid values                             | Ignored                                                                   |
|                   |                                              |                                                                           |
| FrameRateExtD     |                                              |                                                                           |
+-------------------+----------------------------------------------+---------------------------------------------------------------------------+

-----------------------------------
Specifying Configuration Parameters
-----------------------------------

The :ref:`Configuration Parameters table <config-param-table>` summarizes how to specify the configuration
parameters during initialization, encoding, decoding, and video processing.

.. _config-param-table:

.. table:: Configuration Parameters

   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   | **Structure (param)** | **ENCODE** | **ENCODE**   | **DECODE** | **DECODE**   | **VPP**  | **VPP**        |
   |                       | **Init**   | **Encoding** | **Init**   | **Decoding** | **Init** | **Processing** |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   | :cpp:struct:`mfxVideoParam`                                                                               |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  Protected            | R          | -            | R          | -            | R        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  IOPattern            | M          | -            | M          | -            | M        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  ExtParam             | O          | -            | O          | -            | O        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  NumExtParam          | O          | -            | O          | -            | O        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   | :cpp:struct:`mfxInfoMFX`                                                                                  |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  CodecId              | M          | -            | M          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  CodecProfile         | O          | -            | O/M\*      | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  CodecLevel           | O          | -            | O          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+ 
   |  NumThread            | O          | -            | O          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  TargetUsage          | O          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  GopPicSize           | O          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  GopRefDist           | O          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  GopOptFlag           | O          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  IdrInterval          | O          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  RateControlMethod    | O          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  InitialDelayInKB     | O          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  BufferSizeInKB       | O          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  TargetKbps           | M          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  MaxKbps              | O          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  NumSlice             | O          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  NumRefFrame          | O          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  EncodedOrder         | M          | -            | -          | -            | -        | -              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   | :cpp:struct:`mfxFrameInfo`                                                                                |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  FourCC               | M          | M            | M          | M            | M        | M              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  Width                | M          | M            | M          | M            | M        | M              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  Height               | M          | M            | M          | M            | M        | M              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  CropX                | M          | Ign          | Ign        | U            | Ign      | M              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  CropY                | M          | Ign          | Ign        | U            | Ign      | M              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  CropW                | M          | Ign          | Ign        | U            | Ign      | M              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  CropH                | M          | Ign          | Ign        | U            | Ign      | M              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  FrameRateExtN        | M          | Ign          | O          | U            | M        | U              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  FrameRateExtD        | M          | Ign          | O          | U            | M        | U              |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  AspectRatioW         | O          | Ign          | O          | U            | Ign      | PT             |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  AspectRatioH         | O          | Ign          | O          | U            | Ign      | PT             |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  PicStruct            | O          | M            | Ign        | U            | M        | M/U            |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+
   |  ChromaFormat         | M          | M            | M          | M            | Ign      | Ign            |
   +-----------------------+------------+--------------+------------+--------------+----------+----------------+

Legend for the :ref:`Configuration Parameters table <config-param-table>`:

======= =================
Remarks
======= =================
Ign     Ignored
PT      Pass Through
-       Does Not Apply
M       Mandated
R       Reserved
O       Optional
U       Updated at output
======= =================